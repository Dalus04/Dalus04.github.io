<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FF1493">
    <title>Nuestros 360 Papelitos de Amor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* ============ RESET & VARIABLES ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #D4729B;
            --secondary: #E8A5C8;
            --accent: #A6D5E8;
            --dark: #1F1F2E;
            --light: #F9F7F4;
            --gold: #C9A876;
            --success: #88C8B4;

            --bg-body: linear-gradient(135deg, #F9F7F4 0%, #F5F0EB 100%);
            --bg-card: rgba(255, 255, 255, 0.85);
            --bg-card-solid: #ffffff;
            --bg-header: linear-gradient(135deg, #E8A5C8 0%, #A6D5E8 100%);
            --bg-note: linear-gradient(135deg, #FDF9F6 0%, #F5F0EB 100%);
            --border-card: rgba(212, 114, 155, 0.15);
            --border-note: rgba(212, 114, 155, 0.2);
            --text-primary: #1F1F2E;
            --text-secondary: #6B6B78;
            --text-muted: #9B9BA9;
            --shadow-card: 0 12px 40px rgba(0, 0, 0, 0.06);
            --input-border: #E0D5CF;
            --input-bg: #ffffff;
            --tab-line: #F0E8E0;
            --gallery-check-bg: rgba(0, 0, 0, 0.25);
            --empty-color: #9B9BA9;
            --history-bg: linear-gradient(135deg, #FDF9F6 0%, #F5F0EB 100%);
        }

        /* ============ DARK MODE ============ */
        body.dark-mode {
            --bg-body: linear-gradient(135deg, #1F1F2E 0%, #2A2438 100%);
            --bg-card: rgba(60, 50, 75, 0.7);
            --bg-card-solid: #3C3250;
            --bg-header: linear-gradient(135deg, #D4729B 0%, #A6D5E8 100%);
            --bg-note: linear-gradient(135deg, #3C3250 0%, #2A2438 100%);
            --border-card: rgba(212, 114, 155, 0.2);
            --border-note: rgba(212, 114, 155, 0.3);
            --text-primary: #F5F0EB;
            --text-secondary: #B5ACB8;
            --text-muted: #8B8291;
            --shadow-card: 0 12px 40px rgba(0, 0, 0, 0.4);
            --input-border: rgba(212, 114, 155, 0.25);
            --input-bg: rgba(50, 40, 65, 0.9);
            --tab-line: rgba(212, 114, 155, 0.1);
            --gallery-check-bg: rgba(255, 255, 255, 0.2);
            --empty-color: #8B8291;
            --history-bg: linear-gradient(135deg, #3C3250 0%, #2A2438 100%);
        }

        /* ============ BASE ============ */
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: var(--bg-body);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: background 0.5s ease, color 0.4s ease;
            overflow-x: hidden;
            position: relative;
        }

        /* ============ BACK BUTTON ============ */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--border-note);
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-decoration: none;
            color: var(--text-primary);
            font-size: 1.3rem;
        }

        .back-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 20, 147, 0.25);
        }

        /* ============ PARTICLES BACKGROUND ============ */
        .particles-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            opacity: 0;
            animation: particleFloat var(--p-dur, 12s) var(--p-delay, 0s) ease-in-out infinite;
            will-change: transform, opacity;
            font-size: var(--p-size, 1.2rem);
        }

        @keyframes particleFloat {
            0% {
                opacity: 0;
                transform: translateY(100vh) translateX(var(--p-drift-start, 0px)) rotate(0deg) scale(0.5);
            }

            15% {
                opacity: var(--p-opacity, 0.18);
            }

            85% {
                opacity: var(--p-opacity, 0.18);
            }

            100% {
                opacity: 0;
                transform: translateY(-10vh) translateX(var(--p-drift-end, 20px)) rotate(var(--p-rotate, 360deg)) scale(1);
            }
        }

        /* ============ CONTAINER ============ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* ============ THEME TOGGLE ============ */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--border-note);
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 6px 20px rgba(255, 20, 147, 0.25);
        }

        .theme-toggle-icon {
            font-size: 1.3rem;
            transition: transform 0.4s ease;
        }

        body.dark-mode .theme-toggle-icon {
            transform: rotate(180deg);
        }

        /* ============ HEADER ============ */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 60px 20px 50px;
            background: var(--bg-header);
            border-radius: 28px;
            animation: slideDown 0.8s ease-out;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(212, 114, 155, 0.15);
            border: none;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .header-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 3.8rem;
            color: white;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -1.5px;
            line-height: 1.1;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 1;
        }

        .header-content .subtitle {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 35px;
            font-style: italic;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        /* Anniversary Counter - Reordered: Year, Months, Days */
        .anniversary-counter {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }

        .counter-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 25px 35px;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.6);
            text-align: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .counter-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(212, 114, 155, 0.05) 0%, rgba(166, 213, 232, 0.05) 100%);
            z-index: -1;
        }

        .counter-item:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .counter-number {
            display: block;
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 6px;
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .counter-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        /* ============ DAILY NOTE ============ */
        .daily-note {
            background: linear-gradient(135deg, rgba(232, 165, 200, 0.1) 0%, rgba(166, 213, 232, 0.1) 100%);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-radius: 22px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border-card);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .daily-note::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(212, 114, 155, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .daily-note:hover {
            transform: translateY(-6px);
            box-shadow: 0 16px 50px rgba(0, 0, 0, 0.1);
            border-color: rgba(212, 114, 155, 0.3);
        }

        .daily-note-header {
            margin-bottom: 15px;
        }

        .daily-note-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary) 0%, #FF69B4 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .daily-note-body {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .daily-note-color {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 3px solid var(--bg-card-solid);
        }

        .daily-note-text {
            flex: 1;
        }

        .daily-note-message {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 5px;
        }

        .daily-note-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* ============ PROGRESS ============ */
        .progress-section {
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border-card);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .progress-count {
            font-family: 'Playfair Display', Georgia, serif;
            font-weight: 700;
            color: var(--primary);
            font-size: 1rem;
        }

        .progress-bar-bg {
            width: 100%;
            height: 10px;
            background: var(--tab-line);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            border-radius: 10px;
            transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 0 15px rgba(212, 114, 155, 0.4);
        }

        /* ============ MAIN (GLASSMORPHISM) ============ */
        .main {
            background: var(--bg-card);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 26px;
            padding: 45px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-card);
            position: relative;
            overflow: hidden;
        }

        /* ============ TABS ============ */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--tab-line);
            flex-wrap: wrap;
            position: relative;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 14px 28px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-bottom: 3px solid transparent;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            position: relative;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: transparent;
        }

        .tab-btn.active::after {
            width: 100%;
        }

        .tab-content {
            display: none;
            opacity: 0;
            transform: translateX(20px);
        }

        .tab-content.active {
            display: block;
            animation: tabSlideIn 0.45s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        @keyframes tabSlideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* ============ SELECTOR ============ */
        .selector-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            margin-bottom: 45px;
            padding: 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group label {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.05rem;
            display: block;
            margin-bottom: 8px;
        }

        .input-group input {
            padding: 14px 18px;
            border: 2px solid var(--input-border);
            border-radius: 14px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: var(--input-bg);
            color: var(--text-primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 4px 20px rgba(212, 114, 155, 0.2);
            transform: translateY(-2px);
        }

        /* Color Selector - Adjusted sizes */
        .color-selector {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .color-selector label {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.05rem;
            display: block;
            margin-bottom: 12px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(36px, 1fr));
            gap: 8px;
            max-width: 400px;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            max-width: 44px;
            max-height: 44px;
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.12);
            position: relative;
            overflow: hidden;
        }

        .color-option::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.15) translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .color-option:hover::after {
            opacity: 1;
        }

        .color-option.selected {
            border-color: white;
            transform: scale(1.2) translateY(-6px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            filter: brightness(1.1);
        }

        /* Buttons */
        .btn {
            padding: 16px 36px;
            border: none;
            border-radius: 14px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-transform: uppercase;
            letter-spacing: 0.6px;
            grid-column: 1 / -1;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
            z-index: -1;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(212, 114, 155, 0.35);
        }

        .btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(212, 114, 155, 0.5);
        }

        .btn-primary:active {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2.5px solid var(--primary);
            box-shadow: 0 4px 15px rgba(212, 114, 155, 0.15);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(212, 114, 155, 0.35);
        }

        /* ============ FLIP CARD ============ */
        .flip-card {
            perspective: 1200px;
            margin-top: 30px;
            animation: cardEntrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes cardEntrance {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-style: preserve-3d;
        }

        .flip-card-inner.flipped {
            transform: rotateY(180deg);
        }

        .flip-card-inner.flipped .flip-card-front {
            visibility: hidden;
        }

        .flip-card-inner:not(.flipped) .flip-card-back {
            visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
        }

        .flip-card-front,
        .flip-card-back {
            width: 100%;
            min-height: 320px;
            backface-visibility: hidden;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .flip-card-front {
            background: var(--bg-note);
            border: 2px solid var(--border-note);
            padding: 40px;
        }

        .flip-card-back {
            background: var(--bg-note);
            border: 2px solid var(--border-note);
            transform: rotateY(180deg);
            padding: 40px 30px;
        }

        /* ============ NOTE DISPLAY ============ */
        .note-placeholder p {
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 20px;
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .note-content {
            text-align: center;
            width: 100%;
        }

        .note-number {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 12px 26px;
            border-radius: 24px;
            font-weight: 700;
            margin-bottom: 25px;
            font-size: 0.95rem;
            animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 0.1s forwards;
            opacity: 0;
            transform-origin: center;
            box-shadow: 0 6px 20px rgba(212, 114, 155, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .note-color {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            margin: 0 auto 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 3px solid var(--bg-card-solid);
            animation: spin-gentle 6s linear infinite;
        }

        .note-color-name {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 20px;
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.2s forwards;
            opacity: 0;
        }

        .note-message {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 2rem;
            color: var(--text-primary);
            font-weight: 600;
            line-height: 1.8;
            margin: 35px 0;
            letter-spacing: -0.5px;
            position: relative;
            padding: 25px 40px;
            animation: fadeInUp 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s forwards;
            opacity: 0;
            text-wrap: balance;
        }

        .note-message::before,
        .note-message::after {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 4rem;
            color: var(--primary);
            opacity: 0.2;
            position: absolute;
            line-height: 1;
            animation: fadeInSoft 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) 0.4s forwards;
        }

        .note-message::before {
            content: '\201C';
            left: -10px;
            top: -10px;
        }

        .note-message::after {
            content: '\201D';
            right: -10px;
            bottom: -30px;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInSoft {
            from {
                opacity: 0;
            }

            to {
                opacity: 0.2;
            }
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.7);
            }

            50% {
                transform: scale(1.08);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes spin-gentle {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(1deg);
            }

            50% {
                transform: rotate(0deg);
            }

            75% {
                transform: rotate(-1deg);
            }
        }

        .note-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .note-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-favorite {
            background: var(--bg-card-solid);
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-favorite:hover {
            background: var(--primary);
            color: white;
        }

        .btn-favorite.favorited {
            background: var(--primary);
            color: white;
        }

        .btn-share {
            background: linear-gradient(135deg, #87CEEB 0%, #40E0D0 100%);
            color: white;
            border: none;
        }

        .btn-share:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-close {
            background: var(--tab-line);
            color: var(--text-primary);
            border: none;
        }

        .btn-close:hover {
            opacity: 0.8;
        }

        /* ============ GALLERY ============ */
        .gallery-controls {
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 12px 15px;
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .gallery-color-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 15px;
            align-items: center;
        }

        .gallery-filter-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
            position: relative;
        }

        .gallery-filter-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .gallery-filter-btn.active-filter {
            border-color: var(--text-primary);
            transform: scale(1.2);
            box-shadow: 0 4px 15px rgba(255, 20, 147, 0.3);
        }

        .gallery-filter-all {
            background: linear-gradient(135deg, #FF69B4, #87CEEB, #FFD700, #98D8C8);
            width: auto;
            height: auto;
            padding: 6px 14px;
            border-radius: 20px;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(65px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .gallery-item {
            aspect-ratio: 1;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 0.9rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.18);
            border: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            opacity: 0;
            animation: galleryStagger 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            animation-delay: var(--stagger-delay, 0s);
            overflow: hidden;
        }

        @keyframes galleryStagger {
            from {
                opacity: 0;
                transform: scale(0.7) rotateZ(-10deg) translateY(20px);
            }

            50% {
                transform: scale(1.05) rotateZ(2deg);
            }

            to {
                opacity: 1;
                transform: scale(1) rotateZ(0deg) translateY(0);
            }
        }

        .gallery-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.35), transparent);
            transition: left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 14px;
            pointer-events: none;
        }

        .gallery-item:hover::after {
            left: 120%;
        }

        .gallery-item:hover {
            transform: scale(1.18) translateY(-10px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.35);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .gallery-item.opened {
            opacity: 1;
            filter: brightness(0.75);
        }

        .gallery-item .checkmark {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 16px;
            height: 16px;
            background: var(--gallery-check-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
        }

        .gallery-item .favorite-icon {
            position: absolute;
            top: 4px;
            left: 4px;
            font-size: 0.9rem;
        }

        /* ============ HISTORY & FAVORITES ============ */
        .history-container,
        .favorites-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .history-item,
        .favorite-item {
            background: var(--history-bg);
            padding: 25px;
            animation: slideInLeft 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            animation-delay: var(--item-delay, 0s);
            opacity: 0;
            border-radius: 18px;
            border-left: 5px solid;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .history-item::before,
        .favorite-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 100% 0, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            z-index: 0;
        }

        .history-item>*,
        .favorite-item>* {
            position: relative;
            z-index: 1;
        }

        .history-item:hover,
        .favorite-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 14px 40px rgba(0, 0, 0, 0.15);
        }

        .history-item-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .history-item-color {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .history-item-info {
            flex: 1;
        }

        .history-item-number {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .history-item-color-name {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .history-item-message {
            font-family: 'Playfair Display', Georgia, serif;
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 10px;
            font-style: italic;
        }

        .empty-message {
            grid-column: 1 / -1;
            text-align: center;
            color: var(--empty-color);
            padding: 40px 20px;
            font-size: 1.1rem;
        }

        /* ============ SHARE TOAST ============ */
        .share-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(120px);
            background: var(--text-primary);
            color: var(--bg-card-solid);
            padding: 14px 28px;
            border-radius: 14px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            backdrop-filter: blur(10px);
        }

        .share-toast.visible {
            animation: toastPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes toastPop {
            0% {
                transform: translateX(-50%) translateY(120px) scale(0.9);
                opacity: 0;
            }

            100% {
                transform: translateX(-50%) translateY(0) scale(1);
                opacity: 1;
            }
        }

        /* ============ FOOTER TIMELINE ============ */
        .footer-timeline {
            margin-top: 40px;
            padding: 30px;
            background: var(--bg-card);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-radius: 24px;
            border: 1px solid var(--border-card);
            box-shadow: var(--shadow-card);
        }

        .timeline-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
        }

        .timeline-scroll {
            overflow-x: auto;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }

        .timeline-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .timeline-scroll::-webkit-scrollbar-track {
            background: var(--tab-line);
            border-radius: 10px;
        }

        .timeline-scroll::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .timeline-track {
            display: flex;
            gap: 0;
            min-width: max-content;
            position: relative;
            padding: 20px 10px;
        }

        .timeline-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 160px;
            position: relative;
            padding: 0 15px;
            animation: timelineSlideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            animation-delay: var(--timeline-delay, 0s);
            opacity: 0;
        }

        @keyframes timelineSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            top: 14px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, var(--primary) 15%, var(--primary) 85%, transparent 100%);
            opacity: 0.3;
            animation: lineGrow 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            animation-delay: var(--timeline-delay, 0s);
            transform-origin: left;
            transform: scaleX(0);
        }

        @keyframes lineGrow {
            from {
                transform: scaleX(0);
            }

            to {
                transform: scaleX(1);
            }
        }

        .timeline-item:first-child::before {
            left: 50%;
        }

        .timeline-item:last-child::before {
            right: 50%;
        }

        .timeline-dot {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #FF69B4);
            border: 3px solid var(--bg-card-solid);
            box-shadow: 0 3px 10px rgba(255, 20, 147, 0.3);
            position: relative;
            z-index: 1;
            margin-bottom: 12px;
            flex-shrink: 0;
            animation: dotPulse 2s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .timeline-dot:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(255, 20, 147, 0.5);
        }

        @keyframes dotPulse {

            0%,
            100% {
                box-shadow: 0 3px 10px rgba(255, 20, 147, 0.3);
            }

            50% {
                box-shadow: 0 3px 20px rgba(255, 20, 147, 0.6);
            }
        }

        .timeline-date {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            text-align: center;
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            animation-delay: var(--timeline-delay, 0s);
            opacity: 0;
        }

        .timeline-label {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 0.9rem;
            color: var(--text-primary);
            text-align: center;
            line-height: 1.4;
            font-weight: 500;
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            animation-delay: var(--timeline-delay, 0s);
            opacity: 0;
        }

        /* ============ PAPELITO MODAL ============ */
        .papelito-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 9000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            padding: 20px;
        }

        .papelito-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .papelito-paper {
            position: relative;
            width: 100%;
            max-width: 420px;
            transform-style: preserve-3d;
            perspective: 1200px;
        }

        /* --- Folded state --- */
        .papelito-fold {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto;
            cursor: pointer;
            transform-origin: center center;
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 12px 30px rgba(0, 0, 0, 0.25));
        }

        .papelito-fold-face {
            position: absolute;
            inset: 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 8px;
            color: white;
            font-family: 'Playfair Display', Georgia, serif;
            font-weight: 700;
            font-size: 1.6rem;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            background: inherit;
            overflow: hidden;
        }

        .papelito-fold-face::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, transparent 50%, rgba(0, 0, 0, 0.1) 100%);
            pointer-events: none;
        }

        .papelito-fold-face .fold-corner {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, transparent 50%, rgba(0, 0, 0, 0.15) 50%);
            border-radius: 0 0 6px 0;
        }

        .papelito-fold-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.85;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }

        .papelito-fold .tap-hint {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            animation: hintPulse 2s ease-in-out infinite;
        }

        @keyframes hintPulse {

            0%,
            100% {
                opacity: 0.5;
                transform: translateX(-50%) translateY(0);
            }

            50% {
                opacity: 1;
                transform: translateX(-50%) translateY(-3px);
            }
        }

        /* --- Unfolding animation --- */
        .papelito-fold.unfolding {
            width: 100%;
            max-width: 420px;
            height: auto;
            min-height: 360px;
            cursor: default;
            filter: drop-shadow(0 20px 50px rgba(0, 0, 0, 0.3));
        }

        .papelito-fold.unfolding .papelito-fold-face {
            border-radius: 20px;
            align-items: stretch;
            justify-content: flex-start;
            padding: 0;
        }

        .papelito-fold.unfolding .fold-corner,
        .papelito-fold.unfolding .tap-hint,
        .papelito-fold.unfolding .fold-number-display {
            display: none;
        }

        .papelito-fold.unfolding .papelito-fold-label {
            display: none;
        }

        /* --- Revealed content inside the unfolded paper --- */
        .papelito-revealed {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 30px;
            text-align: center;
            width: 100%;
            min-height: 360px;
            opacity: 0;
            position: relative;
            z-index: 1;
        }

        .papelito-fold.unfolding .papelito-revealed {
            display: flex;
            animation: revealContent 0.6s 0.35s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        @keyframes revealContent {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(15px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .papelito-revealed .pr-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(6px);
            color: white;
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-family: 'Inter', sans-serif;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-shadow: none;
        }

        .papelito-revealed .pr-color-dot {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .papelito-revealed .pr-color-name {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.75);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            margin-bottom: 20px;
            text-shadow: none;
        }

        .papelito-revealed .pr-message {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.6rem;
            font-weight: 600;
            color: white;
            line-height: 1.7;
            text-wrap: balance;
            margin-bottom: 25px;
            position: relative;
            padding: 0 10px;
        }

        .papelito-revealed .pr-message::before {
            content: '\201C';
            font-size: 3rem;
            position: absolute;
            top: -25px;
            left: -10px;
            opacity: 0.3;
            line-height: 1;
        }

        .papelito-revealed .pr-message::after {
            content: '\201D';
            font-size: 3rem;
            position: absolute;
            bottom: -35px;
            right: -10px;
            opacity: 0.3;
            line-height: 1;
        }

        .papelito-revealed .pr-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        .papelito-revealed .pr-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(6px);
        }

        .pr-btn-fav {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1.5px solid rgba(255, 255, 255, 0.35) !important;
        }

        .pr-btn-fav:hover {
            background: rgba(255, 255, 255, 0.35);
        }

        .pr-btn-fav.is-fav {
            background: rgba(255, 255, 255, 0.4);
        }

        .pr-btn-share {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1.5px solid rgba(255, 255, 255, 0.35) !important;
        }

        .pr-btn-share:hover {
            background: rgba(255, 255, 255, 0.35);
        }

        .pr-btn-close {
            background: rgba(0, 0, 0, 0.2);
            color: white;
            border: 1.5px solid rgba(255, 255, 255, 0.2) !important;
        }

        .pr-btn-close:hover {
            background: rgba(0, 0, 0, 0.35);
        }

        /* Responsive papelito modal */
        @media (max-width: 768px) {
            .papelito-fold {
                width: 120px;
                height: 120px;
            }

            .papelito-fold-face {
                font-size: 1.3rem;
            }

            .papelito-fold.unfolding {
                min-height: 300px;
            }

            .papelito-revealed {
                padding: 30px 20px;
                min-height: 300px;
            }

            .papelito-revealed .pr-message {
                font-size: 1.3rem;
            }
        }

        /* ============ CONFETTI / HEARTS ============ */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
            overflow: hidden;
        }

        .heart-particle {
            position: absolute;
            top: -40px;
            font-size: 1.4rem;
            opacity: 0;
            animation: heartFall var(--fall-duration, 3s) var(--fall-delay, 0s) ease-in forwards;
            will-change: transform, opacity;
        }

        .confetti-piece {
            position: absolute;
            top: -20px;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            opacity: 0;
            animation: confettiFall var(--fall-duration, 3s) var(--fall-delay, 0s) ease-in forwards;
            will-change: transform, opacity;
        }

        @keyframes heartFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg) scale(1);
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(var(--fall-rotate, 360deg)) scale(0.4);
            }
        }

        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg) scale(1);
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(var(--fall-rotate, 720deg)) scale(0.3);
            }
        }

        /* ============ ANIMATIONS ============ */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        /* ============ RESPONSIVE ============ */
        @media (max-width: 768px) {
            .header-title {
                font-size: 2.2rem;
            }

            .selector-container {
                grid-template-columns: 1fr;
            }

            .note-message {
                font-size: 1.4rem;
                padding: 15px 20px;
            }

            .note-message::before,
            .note-message::after {
                font-size: 3rem;
            }

            .main {
                padding: 20px;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
                gap: 8px;
            }

            .gallery-item {
                font-size: 0.75rem;
                border-radius: 10px;
            }

            .tabs {
                gap: 5px;
            }

            .tab-btn {
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            .daily-note {
                padding: 20px;
            }

            .daily-note-message {
                font-size: 1.1rem;
            }

            .daily-note-color {
                width: 45px;
                height: 45px;
            }

            .flip-card,
            .flip-card-inner,
            .flip-card-front,
            .flip-card-back {
                min-height: 260px;
            }

            .theme-toggle {
                top: 12px;
                right: 12px;
                width: 40px;
                height: 40px;
            }

            .back-btn {
                top: 12px;
                left: 12px;
                width: 40px;
                height: 40px;
            }

            .counter-item {
                padding: 15px 20px;
            }

            .counter-number {
                font-size: 2rem;
            }

            .footer-timeline {
                padding: 20px;
            }

            .timeline-item {
                min-width: 130px;
            }

            .color-option {
                max-width: 38px;
                max-height: 38px;
                border-radius: 10px;
            }

            .color-grid {
                gap: 6px;
            }

            .note-color {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>

<body>
    <!-- Floating particles background -->
    <div class="particles-bg" id="particlesBg"></div>

    <div class="container">
        <!-- Header -->
        <header class="header" id="headerEl">
            <a class="back-btn" href="index.html" aria-label="Volver al inicio">&#8592;</a>
            <button class="theme-toggle" id="themeToggle" aria-label="Cambiar tema">
                <span class="theme-toggle-icon" id="themeIcon">&#9790;</span>
            </button>
            <div class="header-content">
                <h1 class="header-title">Nuestros 360 Papelitos</h1>
                <p class="subtitle">Un papelito por cada dia de nuestro amor</p>
                <div class="anniversary-counter">
                    <div class="counter-item">
                        <span class="counter-number" id="years">0</span>
                        <span class="counter-label">Aos</span>
                    </div>
                    <div class="counter-item">
                        <span class="counter-number" id="months">0</span>
                        <span class="counter-label">Meses</span>
                    </div>
                    <div class="counter-item">
                        <span class="counter-number" id="days">0</span>
                        <span class="counter-label">Dias</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Papelito del Dia -->
        <section class="daily-note" id="dailyNote">
            <div class="daily-note-header">
                <span class="daily-note-badge">Papelito del Dia</span>
            </div>
            <div class="daily-note-body" id="dailyNoteBody">
                <p>Cargando...</p>
            </div>
        </section>

        <!-- Progreso Visual -->
        <section class="progress-section">
            <div class="progress-header">
                <span class="progress-label">Papelitos abiertos</span>
                <span class="progress-count" id="progressCount">0/360</span>
            </div>
            <div class="progress-bar-bg">
                <div class="progress-bar-fill" id="progressBarFill"></div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main">
            <!-- Tabs -->
            <div class="tabs" role="tablist">
                <button class="tab-btn active" data-tab="selector" role="tab" aria-selected="true">Seleccionar</button>
                <button class="tab-btn" data-tab="gallery" role="tab" aria-selected="false">Galeria</button>
                <button class="tab-btn" data-tab="history" role="tab" aria-selected="false">Historial</button>
                <button class="tab-btn" data-tab="favorites" role="tab" aria-selected="false">Favoritos</button>
            </div>

            <!-- Selector Tab -->
            <div class="tab-content active" id="selector" role="tabpanel">
                <div class="selector-container">
                    <div class="input-group">
                        <label for="numberInput">Numero del papelito:</label>
                        <input type="number" id="numberInput" min="1" max="360" placeholder="1-30">
                    </div>

                    <div class="color-selector">
                        <label>Selecciona un color:</label>
                        <div class="color-grid" id="colorGrid"></div>
                    </div>

                    <button class="btn btn-primary" id="searchBtn">Buscar Papelito</button>
                    <button class="btn btn-secondary" id="surpriseBtn">Sorpresa!</button>
                </div>

                <!-- Note Display (Flip Card) -->
                <div class="flip-card" id="flipCard">
                    <div class="flip-card-inner" id="flipCardInner">
                        
                        <div class="flip-card-back" id="flipCardBack"></div>
                    </div>
                </div>
            </div>

            <!-- Gallery Tab -->
            <div class="tab-content" id="gallery" role="tabpanel">
                <div class="gallery-controls">
                    <input type="text" id="gallerySearch" placeholder="Buscar papelito..." class="search-input">
                    <div class="gallery-color-filters" id="galleryColorFilters"></div>
                </div>
                <div class="gallery-grid" id="galleryGrid"></div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history" role="tabpanel">
                <div class="history-container" id="historyContainer">
                    <p class="empty-message">No hay papelitos abiertos aun</p>
                </div>
            </div>

            <!-- Favorites Tab -->
            <div class="tab-content" id="favorites" role="tabpanel">
                <div class="favorites-container" id="favoritesContainer">
                    <p class="empty-message">No hay papelitos favoritos aun</p>
                </div>
            </div>
        </main>

        <!-- Footer Timeline -->
        <footer class="footer-timeline">
            <h3 class="timeline-title">Nuestra Historia</h3>
            <div class="timeline-scroll" id="timelineScroll">
                <div class="timeline-track" id="timelineTrack"></div>
            </div>
        </footer>
    </div>

    <!-- Papelito Modal -->
    <div class="papelito-overlay" id="papelitoOverlay">
        <div class="papelito-paper">
            <div class="papelito-fold" id="papelitoFold">
                <div class="papelito-fold-face" id="papelitoFoldFace">
                    <span class="papelito-fold-label">Papelito</span>
                    <span class="fold-number-display" id="foldNumberDisplay">#1</span>
                    <div class="fold-corner"></div>
                </div>
                <span class="tap-hint">Toca para abrir</span>
                <!-- Revealed content (shown after unfold) -->
                <div class="papelito-revealed" id="papelitoRevealed"></div>
            </div>
        </div>
    </div>

    <!-- Confetti container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <script>
        // ============ STATE ============
        var papelitos = [
            { "numero": 1, "color": "#800080", "colorName": "Morado", "frase": "Quise estar para ti, incluso cuando ten\u00eda otros planes." },
            { "numero": 2, "color": "#800080", "colorName": "Morado", "frase": "Ayudarte se sinti\u00f3 natural desde el inicio." },
            { "numero": 3, "color": "#800080", "colorName": "Morado", "frase": "Me gust\u00f3 poder darte tranquilidad cuando la necesitabas." },
            { "numero": 4, "color": "#800080", "colorName": "Morado", "frase": "Ese examen nos acerc\u00f3 m\u00e1s de lo que imagin\u00e9." },
            { "numero": 5, "color": "#800080", "colorName": "Morado", "frase": "Me sent\u00ed bien cuando confiaste en m\u00ed." },
            { "numero": 6, "color": "#800080", "colorName": "Morado", "frase": "A veces un solo mensaje tuyo me calmaba el d\u00eda." },
            { "numero": 7, "color": "#800080", "colorName": "Morado", "frase": "Aunque hubo silencio, siempre pensaba en ti." },
            { "numero": 8, "color": "#800080", "colorName": "Morado", "frase": "Extra\u00f1\u00e9 esos peque\u00f1os mensajes que me hac\u00edan sentir cerca." },
            { "numero": 9, "color": "#800080", "colorName": "Morado", "frase": "Volver a coincidir contigo se sinti\u00f3 especial." },
            { "numero": 10, "color": "#800080", "colorName": "Morado", "frase": "Despu\u00e9s de la distancia, encontrarte otra vez me hizo sonre\u00edr." },
            { "numero": 11, "color": "#800080", "colorName": "Morado", "frase": "Volver a hablar contigo se sinti\u00f3 como volver a casa." },
            { "numero": 12, "color": "#800080", "colorName": "Morado", "frase": "Me gust\u00f3 quedarme dormido sabiendo que estabas ah\u00ed." },
            { "numero": 13, "color": "#800080", "colorName": "Morado", "frase": "Me encant\u00f3 c\u00f3mo me llevaste a tu sue\u00f1o con tus palabras." },
            { "numero": 14, "color": "#800080", "colorName": "Morado", "frase": "Descubrimos una forma nueva de hablarnos sin palabras." },
            { "numero": 15, "color": "#800080", "colorName": "Morado", "frase": "Tus dibujos ten\u00edan algo que me alegraba el d\u00eda." },
            { "numero": 16, "color": "#800080", "colorName": "Morado", "frase": "Ese monito tuyo se qued\u00f3 conmigo m\u00e1s de lo que crees." },
            { "numero": 17, "color": "#800080", "colorName": "Morado", "frase": "Tu creatividad me hizo querer esforzarme m\u00e1s." },
            { "numero": 18, "color": "#800080", "colorName": "Morado", "frase": "Quise hacer lo mejor para ti, incluso en un dibujo." },
            { "numero": 19, "color": "#800080", "colorName": "Morado", "frase": "Me fui acostumbrando a ti sin darme cuenta." },
            { "numero": 20, "color": "#800080", "colorName": "Morado", "frase": "Mis d\u00edas empezaron a sentirse m\u00e1s lindos contigo." },
            { "numero": 21, "color": "#800080", "colorName": "Morado", "frase": "Aunque hab\u00eda distancia, lo que sent\u00edamos segu\u00eda creciendo." },
            { "numero": 22, "color": "#800080", "colorName": "Morado", "frase": "Algo en ti empez\u00f3 a ser importante para m\u00ed." },
            { "numero": 23, "color": "#800080", "colorName": "Morado", "frase": "La distancia no pudo con lo que empezaba a nacer." },
            { "numero": 24, "color": "#800080", "colorName": "Morado", "frase": "Pasar la noche contigo se volvi\u00f3 algo especial." },
            { "numero": 25, "color": "#800080", "colorName": "Morado", "frase": "Jugando contigo, el tiempo se me iba sin notarlo." },
            { "numero": 26, "color": "#800080", "colorName": "Morado", "frase": "Incluso dormida, te sent\u00eda cerca." },
            { "numero": 27, "color": "#800080", "colorName": "Morado", "frase": "Aunque no pod\u00eda verte, te imaginaba con una sonrisa." },
            { "numero": 28, "color": "#800080", "colorName": "Morado", "frase": "Me gust\u00f3 compartir cosas simples contigo." },
            { "numero": 29, "color": "#800080", "colorName": "Morado", "frase": "Marzo fue el inicio de algo bonito." },
            { "numero": 30, "color": "#800080", "colorName": "Morado", "frase": "Mis d\u00edas empezaron a girar en torno a ti." },
            { "numero": 1, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Empec\u00e9 a desearte d\u00edas lindos, tan lindos como t\u00fa." },
            { "numero": 2, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Querer saber de tus d\u00edas se volvi\u00f3 parte de los m\u00edos." },
            { "numero": 3, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Compartirte un momento m\u00edo, cuidando a cachorrao, se sinti\u00f3 especial." },
            { "numero": 4, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Acompa\u00f1arte cuando estabas triste fue lo \u00fanico que quise hacer." },
            { "numero": 5, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Estar para ti tambi\u00e9n fue una forma de amarte." },
            { "numero": 6, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Empezamos a llamarnos amor, y todo se sinti\u00f3 m\u00e1s cercano." },
            { "numero": 7, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Amor y amor de mi vida, eres todo para m\u00ed." },
            { "numero": 8, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Ver tus fotos de ni\u00f1a me derriti\u00f3 el coraz\u00f3n." },
            { "numero": 9, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Esa t\u00fa, mi bb, termin\u00f3 siendo mi fondo de pantalla." },
            { "numero": 10, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Contarte mis d\u00edas como el Sr. Soto solo para verte re\u00edr vali\u00f3 la pena." },
            { "numero": 11, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Hacerte re\u00edr se volvi\u00f3 una de mis partes favoritas del d\u00eda." },
            { "numero": 12, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Amo que llenes mi galer\u00eda con tus fotos y videos." },
            { "numero": 13, "color": "#98FF98", "colorName": "Verde Menta", "frase": "No hay nada m\u00e1s hermoso que verte en mi pantalla." },
            { "numero": 14, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Declararme tu coach en Roblox, pero verte superarme fue lo mejor." },
            { "numero": 15, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Verte crecer y mejorar me llen\u00f3 de orgullo." },
            { "numero": 16, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Decir te amo nunca dio miedo contigo." },
            { "numero": 17, "color": "#98FF98", "colorName": "Verde Menta", "frase": "El te amo sali\u00f3 sincero y se qued\u00f3 para siempre." },
            { "numero": 18, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Decirte chi por primera vez ya no era tan fr\u00edo." },
            { "numero": 19, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Hasta las palabras m\u00e1s peque\u00f1as se llenan de cari\u00f1o a tu lado." },
            { "numero": 20, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Celebrar mi cumplea\u00f1os contigo, aunque lejos, mantuvo nuestros corazones juntos." },
            { "numero": 21, "color": "#98FF98", "colorName": "Verde Menta", "frase": "La distancia nunca cambi\u00f3 que siempre est\u00e1s conmigo." },
            { "numero": 22, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Tu regalo fue el mejor que pude recibir." },
            { "numero": 23, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Tu notita sigue teniendo un lugar especial en m\u00ed." },
            { "numero": 24, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Recibir fotos tuyas en clase me alegraba todo el d\u00eda." },
            { "numero": 25, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Las videollamadas largas son momentos m\u00e1gicos." },
            { "numero": 26, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Trece horas contigo se sintieron cortas." },
            { "numero": 27, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Empec\u00e9 a subir estados por ti, contigo y para ti." },
            { "numero": 28, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Ese coraz\u00f3n con nuestras manos dijo m\u00e1s que mil palabras." },
            { "numero": 29, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Firmar nuestra acta de matrimonio robloxiana fue perfecto." },
            { "numero": 30, "color": "#98FF98", "colorName": "Verde Menta", "frase": "Moonlight y How Deep Is Your Love empezaron a sonar como nosotros en nuestros estados." },
            { "numero": 1, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Hacer nuestras iniciales en los chetes hizo real lo que ya sent\u00edamos." },
            { "numero": 2, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Ver nuestras iniciales en nuestra piel me hizo sentir que eres m\u00eda y yo tuyo." },
            { "numero": 3, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Poner una foto juntos fue mostrarle al mundo lo que ya \u00e9ramos." },
            { "numero": 4, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Contigo dej\u00e9 de pensar en yo y empec\u00e9 a sentir nosotros." },
            { "numero": 5, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Cada canci\u00f3n que me dedicabas tocaba algo profundo en m\u00ed." },
            { "numero": 6, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Las canciones dejaron de sonar igual desde que llevan tu nombre." },
            { "numero": 7, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Entend\u00ed que todo en mi camino me estaba acercando a ti." },
            { "numero": 8, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Aprender tus jergas fue aprender tu mundo." },
            { "numero": 9, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Cuando me ense\u00f1aste latear, fue una sonrisa tuya ense\u00f1\u00e1ndomela." },
            { "numero": 10, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Nuestra manera de hablar se volvi\u00f3 parte de mis d\u00edas." },
            { "numero": 11, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Llegar a Lima sabiendo que estabas t\u00fa lo cambi\u00f3 todo." },
            { "numero": 12, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Que me ayudaras con mi estad\u00eda me hizo sentir cuidado por ti." },
            { "numero": 13, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Dianelita fue un regalo lleno del amor que siento por ti." },
            { "numero": 14, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Verte feliz con ese peluche hizo que todo valiera la pena." },
            { "numero": 15, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Nuestra velada en Lima fue perfecta y se qued\u00f3 en mi coraz\u00f3n." },
            { "numero": 16, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "El primer d\u00eda a tu lado confirm\u00f3 lo que mi coraz\u00f3n ya sab\u00eda." },
            { "numero": 17, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Caminar contigo por las calles hizo que todo brillara distinto." },
            { "numero": 18, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Jironear contigo fue descubrir la ciudad desde el amor." },
            { "numero": 19, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Las fotos que nos tomamos guardan un recuerdo que quiero repetir infinitas veces." },
            { "numero": 20, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Verte en pijama afuera de tu casa fue uno de los momentos m\u00e1s tiernos." },
            { "numero": 21, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Contigo, cualquier instante cotidiano se vuelve inolvidable." },
            { "numero": 22, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Una p\u00e1gina para nuestra historia fue mi forma de decir que veo un futuro contigo." },
            { "numero": 23, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Nuestra historia merece ser escrita y recordada." },
            { "numero": 24, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Hacer quizzes contigo me mostr\u00f3 cu\u00e1nto nos conocemos." },
            { "numero": 25, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Descubrirte nunca deja de enamorarme y sorprenderme." },
            { "numero": 26, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Cada canci\u00f3n que te dedico lleva parte de mi alma." },
            { "numero": 27, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Para ti va mi coraz\u00f3n completo." },
            { "numero": 28, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Compartir nuestras fotos de ni\u00f1os fue abrirnos el alma." },
            { "numero": 29, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Saber que estuve en Lima de peque\u00f1o me hizo pensar que el destino ya sab\u00eda de nosotros." },
            { "numero": 30, "color": "#DC143C", "colorName": "Rojo Carmes\u00ed", "frase": "Amarte hace que todo tenga m\u00e1s sentido." }
        ];
        var currentNote = null;
        var openedNotes = new Set();
        var favoriteNotes = new Set();
        var selectedColor = null;
        var activeGalleryColor = null;

        // ============ TIMELINE DATA ============
        var timelineEvents = [
            { date: 'Febrero 2025', label: 'Donde comenz nuestro destino' },
            { date: 'Abril 2025', label: 'El mes en que empezamos a ser uno' },
            { date: 'Mayo 2025', label: 'Nuestra primera aventura' },
            { date: 'Junio 2025', label: 'Nos regalamos amor en forma de detalles' },
            { date: 'Agosto 2025', label: 'A tu lado, todo se volvi mgico' },
            { date: 'Septiembre 2025', label: 'En este mes naci quien hace latir mi corazn.' },
            { date: 'Noviembre 2025', label: 'Ese picnic mgico sellado con nuestro para siempre' },
            { date: 'Febrero 2026', label: 'El primer San Valentn, inolvidable.' },
            { date: 'Abril 2026', label: 'Cumpliremos un ao y cada da te amo ms.' },
            { date: 'Siempre', label: 'Por muchos mas...' }
        ];

        // ============ INIT ============
        document.addEventListener('DOMContentLoaded', function () {
            loadFromLocalStorage();
            loadTheme();
            updateAnniversaryCounter();
            renderColorSelector();
            renderGallery();
            renderGalleryColorFilters();
            renderDailyNote();
            updateProgress();
            createParticles();
            renderTimeline();
            attachEventListeners();
            initParallax();
        });

        // ============ EVENTS ============
        function attachEventListeners() {
            document.getElementById('searchBtn').addEventListener('click', searchPapelito);
            document.getElementById('surpriseBtn').addEventListener('click', surprisePapelito);
            document.getElementById('numberInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') searchPapelito();
            });

            document.querySelectorAll('.tab-btn').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    switchTab(btn.dataset.tab);
                });
            });

            document.getElementById('gallerySearch').addEventListener('input', function (e) {
                filterGallery(e.target.value);
            });

            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') closePapelitoModal();
            });
        }

        // ============ DARK MODE ============
        function toggleTheme() {
            var isDark = document.body.classList.toggle('dark-mode');
            var icon = document.getElementById('themeIcon');
            icon.innerHTML = isDark ? '&#9788;' : '&#9790;';
            localStorage.setItem('papelitos-theme', isDark ? 'dark' : 'light');
        }

        function loadTheme() {
            var saved = localStorage.getItem('papelitos-theme');
            if (saved === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').innerHTML = '&#9788;';
            }
        }

        // ============ FLOATING PARTICLES ============
        function createParticles() {
            var container = document.getElementById('particlesBg');
            var shapes = ['\u2661', '\u2665', '\u2726', '\u2727', '\u00B7'];
            var count = 20;

            for (var i = 0; i < count; i++) {
                var p = document.createElement('div');
                p.className = 'particle';
                p.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                p.style.left = Math.random() * 100 + '%';
                p.style.setProperty('--p-dur', (10 + Math.random() * 15) + 's');
                p.style.setProperty('--p-delay', (Math.random() * 12) + 's');
                p.style.setProperty('--p-size', (0.8 + Math.random() * 1.2) + 'rem');
                p.style.setProperty('--p-opacity', (0.08 + Math.random() * 0.14).toFixed(2));
                p.style.setProperty('--p-drift-start', (Math.random() * 40 - 20) + 'px');
                p.style.setProperty('--p-drift-end', (Math.random() * 60 - 30) + 'px');
                p.style.setProperty('--p-rotate', (Math.random() * 360) + 'deg');
                container.appendChild(p);
            }
        }

        // ============ PARALLAX ============
        function initParallax() {
            var header = document.getElementById('headerEl');
            if (!header) return;
            var title = header.querySelector('.header-title');
            var subtitle = header.querySelector('.subtitle');
            var counter = header.querySelector('.anniversary-counter');

            window.addEventListener('scroll', function () {
                var scrollY = window.scrollY;
                if (scrollY > 500) return;
                var slow = scrollY * 0.15;
                var fast = scrollY * 0.3;
                if (title) title.style.transform = 'translateY(' + slow + 'px)';
                if (subtitle) subtitle.style.transform = 'translateY(' + (slow * 0.7) + 'px)';
                if (counter) counter.style.transform = 'translateY(' + (-fast * 0.2) + 'px)';
            }, { passive: true });
        }

        // ============ TIMELINE ============
        function renderTimeline() {
            var track = document.getElementById('timelineTrack');
            if (!track) return;
            track.innerHTML = '';

            timelineEvents.forEach(function (evt, idx) {
                var item = document.createElement('div');
                item.className = 'timeline-item';
                var delay = idx * 0.1;
                item.style.setProperty('--timeline-delay', delay + 's');

                item.innerHTML =
                    '<div class="timeline-dot"></div>' +
                    '<div class="timeline-date">' + evt.date + '</div>' +
                    '<div class="timeline-label">' + evt.label + '</div>';
                track.appendChild(item);
            });
        }

        // ============ ANNIVERSARY (Year, Months, Days order) ============
        function updateAnniversaryCounter() {
            var meetDate = new Date('2025-04-23');
            var today = new Date();
            var diffMs = today - meetDate;
            var diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            var years = Math.floor(diffDays / 365);
            var months = Math.floor((diffDays % 365) / 30);
            var days = diffDays % 30;

            document.getElementById('years').textContent = years;
            document.getElementById('months').textContent = months;
            document.getElementById('days').textContent = days;
        }

        // ============ COLORS ============
        function renderColorSelector() {
            var colorGrid = document.getElementById('colorGrid');
            var seen = {};
            var colors = [];

            papelitos.forEach(function (p) {
                if (!seen[p.color]) {
                    seen[p.color] = true;
                    colors.push({ color: p.color, name: p.colorName });
                }
            });

            colors.forEach(function (c) {
                var el = document.createElement('div');
                el.className = 'color-option';
                el.style.backgroundColor = c.color;
                el.title = c.name;
                el.setAttribute('role', 'button');
                el.setAttribute('aria-label', 'Color ' + c.name);
                el.addEventListener('click', function () {
                    document.querySelectorAll('.color-option').forEach(function (o) {
                        o.classList.remove('selected');
                    });
                    el.classList.add('selected');
                    selectedColor = c.color;
                });
                colorGrid.appendChild(el);
            });
        }

        // ============ SEARCH ============
        function searchPapelito() {
            var num = parseInt(document.getElementById('numberInput').value);

            if (!num || num < 1 || num > 30) {
                alert('Por favor ingresa un numero entre 1 y 30');
                return;
            }
            if (selectedColor === null) {
                alert('Por favor selecciona un color');
                return;
            }

            var papelito = papelitos.find(function (p) {
                return p.numero === num && p.color === selectedColor;
            });

            if (papelito) {
                displayNote(papelito);
                addToHistory(papelito);
            } else {
                alert('Papelito no encontrado. Intenta con otro numero o color.');
            }
        }

        // ============ SURPRISE ============
        function surprisePapelito() {
            var rand = papelitos[Math.floor(Math.random() * papelitos.length)];
            displayNote(rand);
            addToHistory(rand);
        }

        // ============ DISPLAY NOTE (Papelito Modal) ============
        function displayNote(papelito) {
            currentNote = papelito;
            var overlay = document.getElementById('papelitoOverlay');
            var fold = document.getElementById('papelitoFold');
            var foldFace = document.getElementById('papelitoFoldFace');
            var revealed = document.getElementById('papelitoRevealed');
            var numberDisplay = document.getElementById('foldNumberDisplay');
            var key = papelito.numero + '-' + papelito.color;
            var isFav = favoriteNotes.has(key);

            // Reset state
            fold.classList.remove('unfolding');
            void fold.offsetWidth;

            // Set color and number on folded face
            foldFace.style.background = papelito.color;
            numberDisplay.textContent = '#' + papelito.numero;

            // Prepare revealed content
            revealed.innerHTML =
                '<span class="pr-badge">Papelito #' + papelito.numero + '</span>' +
                '<div class="pr-color-dot"></div>' +
                '<span class="pr-color-name">' + papelito.colorName + '</span>' +
                '<div class="pr-message">' + papelito.frase + '</div>' +
                '<div class="pr-actions">' +
                '<button class="pr-btn pr-btn-fav ' + (isFav ? 'is-fav' : '') + '" id="modalFavBtn">' +
                (isFav ? '\u2764\uFE0F Favorito' : '\u{1F90D} Guardar') +
                '</button>' +
                '<button class="pr-btn pr-btn-share" id="modalShareBtn">Compartir</button>' +
                '<button class="pr-btn pr-btn-close" id="modalCloseBtn">Cerrar</button>' +
                '</div>';

            // Show overlay
            overlay.classList.add('visible');
            document.body.style.overflow = 'hidden';

            // Attach fold click to unfold
            fold.onclick = function () {
                if (!fold.classList.contains('unfolding')) {
                    fold.classList.add('unfolding');
                    foldFace.style.background = papelito.color;
                    launchConfetti();
                }
            };

            // Attach button events after a small delay so they exist in DOM
            setTimeout(function () {
                var favBtn = document.getElementById('modalFavBtn');
                var shareBtn = document.getElementById('modalShareBtn');
                var closeBtn = document.getElementById('modalCloseBtn');

                if (favBtn) favBtn.onclick = function (e) { e.stopPropagation(); toggleFavoriteModal(); };
                if (shareBtn) shareBtn.onclick = function (e) { e.stopPropagation(); shareNote(); };
                if (closeBtn) closeBtn.onclick = function (e) { e.stopPropagation(); closePapelitoModal(); };
            }, 50);

            // Close on overlay click (outside paper)
            overlay.onclick = function (e) {
                if (e.target === overlay) closePapelitoModal();
            };
        }

        function closePapelitoModal() {
            var overlay = document.getElementById('papelitoOverlay');
            var fold = document.getElementById('papelitoFold');
            overlay.classList.remove('visible');
            document.body.style.overflow = '';
            setTimeout(function () {
                fold.classList.remove('unfolding');
            }, 400);
        }

        function toggleFavoriteModal() {
            if (!currentNote) return;
            var key = currentNote.numero + '-' + currentNote.color;
            var btn = document.getElementById('modalFavBtn');

            if (favoriteNotes.has(key)) {
                favoriteNotes.delete(key);
                if (btn) { btn.classList.remove('is-fav'); btn.innerHTML = '\u{1F90D} Guardar'; }
            } else {
                favoriteNotes.add(key);
                if (btn) { btn.classList.add('is-fav'); btn.innerHTML = '\u2764\uFE0F Favorito'; }
            }
            saveToLocalStorage();
            renderFavorites();
        }

        // ============ HISTORY ============
        function addToHistory(papelito) {
            var key = papelito.numero + '-' + papelito.color;
            openedNotes.add(key);
            saveToLocalStorage();
            updateGalleryDisplay();
            updateProgress();
        }

        // ============ FAVORITE (legacy, now handled via modal) ============
        function toggleFavorite() {
            toggleFavoriteModal();
        }

        // ============ CLOSE NOTE (legacy, now handled via modal) ============
        function closeNote() {
            closePapelitoModal();
        }

        // ============ SHARE ============
        function shareNote() {
            if (!currentNote) return;
            var text = '\u201C' + currentNote.frase + '\u201D - Papelito #' + currentNote.numero + ' (' + currentNote.colorName + ')';
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(function () {
                    showToast('Frase copiada al portapapeles');
                }).catch(function () {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            var ta = document.createElement('textarea');
            ta.value = text;
            ta.style.position = 'fixed';
            ta.style.left = '-9999px';
            document.body.appendChild(ta);
            ta.select();
            try { document.execCommand('copy'); showToast('Frase copiada al portapapeles'); }
            catch (e) { showToast('No se pudo copiar'); }
            document.body.removeChild(ta);
        }

        function showToast(msg) {
            var existing = document.querySelector('.share-toast');
            if (existing) existing.remove();
            var toast = document.createElement('div');
            toast.className = 'share-toast';
            toast.textContent = msg;
            document.body.appendChild(toast);
            requestAnimationFrame(function () {
                toast.classList.add('visible');
            });
            setTimeout(function () {
                toast.classList.remove('visible');
                setTimeout(function () { toast.remove(); }, 400);
            }, 2500);
        }

        // ============ CONFETTI / HEARTS ============
        function launchConfetti() {
            var container = document.getElementById('confettiContainer');
            container.innerHTML = '';
            var hearts = ['\u2764', '\u{1F497}', '\u{1F496}', '\u{1F49D}', '\u{1F49E}', '\u{1F49F}'];
            var confettiColors = ['#FF1493', '#FF69B4', '#FFB6C1', '#FF7F50', '#FFD700', '#87CEEB', '#98D8C8', '#DDA0DD'];

            for (var i = 0; i < 15; i++) {
                var h = document.createElement('div');
                h.className = 'heart-particle';
                h.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                h.style.left = Math.random() * 100 + '%';
                h.style.setProperty('--fall-duration', (2 + Math.random() * 2) + 's');
                h.style.setProperty('--fall-delay', (Math.random() * 0.8) + 's');
                h.style.setProperty('--fall-rotate', (Math.random() * 360 - 180) + 'deg');
                h.style.fontSize = (1 + Math.random() * 1.2) + 'rem';
                container.appendChild(h);
            }

            for (var j = 0; j < 25; j++) {
                var c = document.createElement('div');
                c.className = 'confetti-piece';
                c.style.left = Math.random() * 100 + '%';
                c.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                c.style.setProperty('--fall-duration', (2 + Math.random() * 2.5) + 's');
                c.style.setProperty('--fall-delay', (Math.random() * 0.6) + 's');
                c.style.setProperty('--fall-rotate', (Math.random() * 720) + 'deg');
                c.style.width = (6 + Math.random() * 8) + 'px';
                c.style.height = (6 + Math.random() * 8) + 'px';
                c.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                container.appendChild(c);
            }

            setTimeout(function () { container.innerHTML = ''; }, 5000);
        }

        // ============ GALLERY ============
        function renderGallery() {
            var grid = document.getElementById('galleryGrid');
            grid.innerHTML = '';

            papelitos.forEach(function (p, idx) {
                var item = document.createElement('div');
                item.className = 'gallery-item';
                item.style.backgroundColor = p.color;
                item.setAttribute('role', 'button');
                item.setAttribute('aria-label', 'Papelito numero ' + p.numero);
                var delay = Math.min(idx, 80) * 0.012;
                item.style.setProperty('--stagger-delay', delay + 's');

                var key = p.numero + '-' + p.color;
                if (openedNotes.has(key)) item.classList.add('opened');

                var html = p.numero.toString();
                if (favoriteNotes.has(key)) html += '<div class="favorite-icon">\u2764\uFE0F</div>';
                if (openedNotes.has(key)) html += '<div class="checkmark">\u2713</div>';
                item.innerHTML = html;

                item.addEventListener('click', function () {
                    displayNote(p);
                    addToHistory(p);
                });

                grid.appendChild(item);
            });
        }

        function filterGallery(term) {
            var items = document.querySelectorAll('.gallery-item');
            var t = (term || '').toLowerCase();
            items.forEach(function (item, i) {
                var p = papelitos[i];
                var textMatch = !t || p.numero.toString().includes(t) || p.colorName.toLowerCase().includes(t);
                var colorMatch = !activeGalleryColor || p.color === activeGalleryColor;
                item.style.display = (textMatch && colorMatch) ? 'flex' : 'none';
            });
        }

        function renderGalleryColorFilters() {
            var container = document.getElementById('galleryColorFilters');
            container.innerHTML = '';
            var seen = {};
            var colors = [];
            papelitos.forEach(function (p) {
                if (!seen[p.color]) {
                    seen[p.color] = true;
                    colors.push({ color: p.color, name: p.colorName });
                }
            });

            var allBtn = document.createElement('button');
            allBtn.className = 'gallery-filter-btn gallery-filter-all active-filter';
            allBtn.textContent = 'Todos';
            allBtn.title = 'Mostrar todos';
            allBtn.addEventListener('click', function () {
                activeGalleryColor = null;
                document.querySelectorAll('.gallery-filter-btn').forEach(function (b) { b.classList.remove('active-filter'); });
                allBtn.classList.add('active-filter');
                filterGallery(document.getElementById('gallerySearch').value);
            });
            container.appendChild(allBtn);

            colors.forEach(function (c) {
                var btn = document.createElement('button');
                btn.className = 'gallery-filter-btn';
                btn.style.backgroundColor = c.color;
                btn.title = c.name;
                btn.setAttribute('aria-label', 'Filtrar por ' + c.name);
                btn.addEventListener('click', function () {
                    activeGalleryColor = c.color;
                    document.querySelectorAll('.gallery-filter-btn').forEach(function (b) { b.classList.remove('active-filter'); });
                    btn.classList.add('active-filter');
                    filterGallery(document.getElementById('gallerySearch').value);
                });
                container.appendChild(btn);
            });
        }

        // ============ DAILY NOTE ============
        function renderDailyNote() {
            var today = new Date();
            var dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            var index = dayOfYear % papelitos.length;
            var p = papelitos[index];

            var body = document.getElementById('dailyNoteBody');
            body.innerHTML =
                '<div class="daily-note-color" style="background-color: ' + p.color + '"></div>' +
                '<div class="daily-note-text">' +
                '<div class="daily-note-message">\u201C' + p.frase + '\u201D</div>' +
                '<div class="daily-note-meta">#' + p.numero + ' &middot; ' + p.colorName + '</div>' +
                '</div>';

            document.getElementById('dailyNote').addEventListener('click', function () {
                displayNote(p);
                addToHistory(p);
            });
        }

        // ============ PROGRESS ============
        function updateProgress() {
            var total = papelitos.length;
            var opened = openedNotes.size;
            var pct = total > 0 ? (opened / total * 100) : 0;
            document.getElementById('progressCount').textContent = opened + '/' + total;
            document.getElementById('progressBarFill').style.width = pct + '%';
        }

        function updateGalleryDisplay() {
            document.querySelectorAll('.gallery-item').forEach(function (item, i) {
                var p = papelitos[i];
                var key = p.numero + '-' + p.color;
                if (openedNotes.has(key)) {
                    item.classList.add('opened');
                    if (!item.querySelector('.checkmark')) {
                        var ck = document.createElement('div');
                        ck.className = 'checkmark';
                        ck.innerHTML = '\u2713';
                        item.appendChild(ck);
                    }
                }
            });
        }

        // ============ RENDER HISTORY ============
        function renderHistory() {
            var container = document.getElementById('historyContainer');
            if (openedNotes.size === 0) {
                container.innerHTML = '<p class="empty-message">No hay papelitos abiertos aun</p>';
                return;
            }
            container.innerHTML = '';

            var sorted = Array.from(openedNotes).map(function (key) {
                var parts = key.split('-');
                var num = parseInt(parts[0]);
                var color = parts.slice(1).join('-');
                return papelitos.find(function (p) { return p.numero === num && p.color === color; });
            }).filter(Boolean).sort(function (a, b) { return a.numero - b.numero; });

            sorted.forEach(function (p, idx) {
                var el = document.createElement('div');
                el.className = 'history-item';
                el.style.borderLeftColor = p.color;
                var delay = idx * 0.08;
                el.style.setProperty('--item-delay', delay + 's');

                el.innerHTML =
                    '<div class="history-item-header">' +
                    '<div class="history-item-color" style="background-color: ' + p.color + '"></div>' +
                    '<div class="history-item-info">' +
                    '<div class="history-item-number">#' + p.numero + '</div>' +
                    '<div class="history-item-color-name">' + p.colorName + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<p class="history-item-message">\u201C' + p.frase + '\u201D</p>';
                el.addEventListener('click', function () {
                    displayNote(p);
                });
                container.appendChild(el);
            });
        }

        // ============ RENDER FAVORITES ============
        function renderFavorites() {
            var container = document.getElementById('favoritesContainer');
            if (favoriteNotes.size === 0) {
                container.innerHTML = '<p class="empty-message">No hay papelitos favoritos aun</p>';
                return;
            }
            container.innerHTML = '';

            var sorted = Array.from(favoriteNotes).map(function (key) {
                var parts = key.split('-');
                var num = parseInt(parts[0]);
                var color = parts.slice(1).join('-');
                return papelitos.find(function (p) { return p.numero === num && p.color === color; });
            }).filter(Boolean).sort(function (a, b) { return a.numero - b.numero; });

            sorted.forEach(function (p, idx) {
                var el = document.createElement('div');
                el.className = 'favorite-item';
                el.style.borderLeftColor = p.color;
                var delay = idx * 0.08;
                el.style.setProperty('--item-delay', delay + 's');

                el.innerHTML =
                    '<div class="history-item-header">' +
                    '<div class="history-item-color" style="background-color: ' + p.color + '"></div>' +
                    '<div class="history-item-info">' +
                    '<div class="history-item-number">\u2764\uFE0F #' + p.numero + '</div>' +
                    '<div class="history-item-color-name">' + p.colorName + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<p class="history-item-message">\u201C' + p.frase + '\u201D</p>';
                el.addEventListener('click', function () {
                    displayNote(p);
                });
                container.appendChild(el);
            });
        }

        // ============ TABS ============
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(function (t) { t.classList.remove('active'); });
            document.querySelectorAll('.tab-btn').forEach(function (b) {
                b.classList.remove('active');
                b.setAttribute('aria-selected', 'false');
            });

            document.getElementById(tabName).classList.add('active');
            var activeBtn = document.querySelector('[data-tab="' + tabName + '"]');
            activeBtn.classList.add('active');
            activeBtn.setAttribute('aria-selected', 'true');

            if (tabName === 'history') renderHistory();
            if (tabName === 'favorites') renderFavorites();
        }

        // ============ LOCAL STORAGE ============
        function saveToLocalStorage() {
            localStorage.setItem('openedNotes', JSON.stringify(Array.from(openedNotes)));
            localStorage.setItem('favoriteNotes', JSON.stringify(Array.from(favoriteNotes)));
        }

        function loadFromLocalStorage() {
            var opened = localStorage.getItem('openedNotes');
            var favs = localStorage.getItem('favoriteNotes');
            if (opened) openedNotes = new Set(JSON.parse(opened));
            if (favs) favoriteNotes = new Set(JSON.parse(favs));
        }
    </script>
</body>

</html>